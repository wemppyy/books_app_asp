@page
@model books_app.Pages.LibraryModel
@{
}

<h1>Library</h1>

<div class="row">
    <div class="col-12 col-md-6">
        <h2>Authors</h2>
        <div class="input-group mb-2">
            <input type="text" id="authorSearch" class="form-control" placeholder="Search authors..." />
        </div>
        <div class="table-responsive">
            <table id="authorsTable" class="table table-striped">
                <thead>
                    <tr>
                        <th>Id</th>
                        <th>Full name</th>
                        <th>Birthdate</th>
                        <th>Books</th>
                    </tr>
                </thead>
                <tbody>
                    @if (Model?.Authors?.Any() == true)
                    {
                        foreach (var a in Model.Authors)
                        {
                            <tr onclick="window.location='/AuthorProfile?id=@a.Id'" style="cursor:pointer;">
                                <td>@a.Id</td>
                                <td>@($"{a.FirstName} {a.LastName}")</td>
                                <td>@a.DateOfBirth.ToString("yyyy-MM-dd")</td>
                                <td>@(Model?.Books?.Count(b => b.AuthorId == a.Id) ?? 0)</td>
                            </tr>
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="4">No authors found.</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>

<script>
    (function() {
        function setupSearch(inputId, tableId, columnIndex) {
            var input = document.getElementById(inputId);
            var table = document.getElementById(tableId);
            if (!input || !table) return;
            input.addEventListener('input', function() {
                var q = input.value.trim().toLowerCase();
                var rows = table.tBodies[0].rows;
                for (var i = 0; i < rows.length; i++) {
                    var cell = rows[i].cells[columnIndex];
                    var text = cell ? cell.innerText.toLowerCase() : '';
                    rows[i].style.display = text.indexOf(q) !== -1 ? '' : 'none';
                }
            });
        }

        document.addEventListener('DOMContentLoaded', function() {
            setupSearch('authorSearch', 'authorsTable', 1);
            setupSearch('bookSearch', 'booksTable', 1);
        });
    })();
</script>


    <div class="col-12 col-md-6">
        <h2>Books</h2>
        <div class="input-group mb-2">
            <input type="text" id="bookSearch" class="form-control" placeholder="Search books..." />
        </div>
        <div class="table-responsive">
            <table id="booksTable" class="table table-striped">
                <thead>
                    <tr>
                        <th>Id</th>
                        <th>Title</th>
                        <th>ISBN</th>
                        <th>Year</th>
                        <th>Author</th>
                    </tr>
                </thead>
                <tbody>
                    @if (Model?.Books?.Any() == true)
                    {
                        foreach (var book in Model.Books)
                        {
                            <tr onclick="window.location='/BookProfile?id=@book.Id'" style="cursor:pointer;">
                                <td>@book.Id</td>
                                <td>@book.Title</td>
                                <td>@book.ISBN</td>
                                <td>@(book.PublishYear.Year)</td>
                                <td>@book.AuthorId</td>
                            </tr>
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="5">No books found.</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>
